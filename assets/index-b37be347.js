import{r as o,j as e}from"./index-891b7aea.js";import{F as g,b as U,I as B,S,T as y,C as de,B as p,P as oe,U as ce,c as ue,d as V,D as Q,L as me,n as b,m as q,e as he,E as xe,f as ge,a as fe}from"./axios-b9beea9f.js";const{Content:ye}=me,{TextArea:pe}=B;async function R(E){let m=null,_=null,k=null,I={method:"get",maxBodyLength:1/0,url:"https://blockchain.info/balance?active="+E,headers:{}};return await fe.request(I).then(f=>{let l=f.data;m=(parseInt(Object.values(l)[0].final_balance)/1e8).toFixed(8),_=Object.values(l)[0].n_tx,k=(parseInt(Object.values(l)[0].total_received)/1e8).toFixed(8)}).catch(f=>(console.log(f),{final_balance:"error",n_tx:"error",total_received:"error"})),{final_balance:m,n_tx:_,total_received:k}}function be(){const[E,m]=o.useState(0),[_,k]=o.useState(0),[I,f]=o.useState(!1),[l,c]=o.useState([]),[H,A]=o.useState(!1),[T]=g.useForm(),[h,w]=o.useState([]),[P]=g.useForm(),[W,F]=o.useState(!1),[v,z]=o.useState(!1),[$,J]=o.useState(!1);o.useEffect(()=>{m(0)},[]);const Y=async()=>{try{const t=await P.validateFields();F(!1);const s=l.findIndex(a=>a.address===t.address);if(s!==-1){c(l.map((n,d)=>d===s?{...n,name:t.name}:n));const a=[...l];R(t.address).then(({final_balance:n,n_tx:d,total_received:r})=>{a[s]={...a[s],final_balance:n,n_tx:d,total_received:r},c(a),localStorage.setItem("btc_addresses",JSON.stringify(l))})}else{const a={key:l.length.toString(),name:t.name,address:t.address,final_balance:null,n_tx:null,total_received:null},n=[...l,a];c(n),R(t.address).then(({final_balance:d,n_tx:r,total_received:u})=>{console.log("---final"+d),console.log("---n_tx"+r),console.log("---total_received"+u),a.final_balance=d,a.n_tx=r,a.total_received=u,c([...n]),localStorage.setItem("btc_addresses",JSON.stringify(n))})}}catch(t){b.error({message:"ERROR",description:t.message},2)}finally{P.resetFields()}},G=async()=>{if(!h.length){b.error({message:"ERROR",description:"Please select which address to REFRESH"},2);return}z(!0);try{let s=0,a=[];const n=[...l],d=()=>{for(;s<50&&a.length>0;){const r=a.shift();s+=1,r().finally(()=>{s-=1,d()})}};for(let r of h){const u=n.findIndex(i=>i.key===r);if(u!==-1){const i=n[u];a.push(()=>(i.final_balance=null,i.n_tx=null,i.total_received=null,R(i.address).then(({final_balance:O,n_tx:x,total_received:N})=>{i.final_balance=O,i.n_tx=x,i.total_received=N,c([...n]),localStorage.setItem("btc_addresses",JSON.stringify(n))})))}d()}for(;s>0||a.length>0;)await new Promise(r=>setTimeout(r,100))}catch(t){b.error({message:"ERROR",description:t.message},2)}finally{z(!1),w([]),q.success("REFRESH SUCCESSFULLY")}},X=async()=>{try{f(!0),A(!1);const s=(await T.validateFields()).addresses.split(`
`);k(s.length);const a=[...l],n=50;let d=0,r=[];m(0);const u=()=>{for(;r.length>0&&d<n;){const i=r.shift();d+=1,i().finally(()=>{d-=1,u()})}};for(let i of s){let O="",x="";i.indexOf(",")!=-1?(O=i.split(",")[0].trim(),x=i.split(",")[1].trim()):x=i.trim();let N=()=>new Promise((j,K)=>{m(D=>D+1),j()});const L=a.findIndex(j=>j.address===x),C=L!==-1?a[L]:{key:a.length.toString(),name:O,address:x,final_balance:null,n_tx:null,total_received:null};L===-1&&a.push(C),r.push(()=>R(x).then(({final_balance:j,n_tx:K,total_received:D})=>{C.final_balance=j,C.n_tx=K,C.total_received=D})),r.push(N),u()}for(;d>0||r.length>0;)await new Promise(i=>setTimeout(i,100));c(a),localStorage.setItem("btc_addresses",JSON.stringify(a))}catch(t){b.error({message:"ERROR",description:t.message})}finally{f(!1),m(0),T.resetFields(),w([]),q.success("Batch Import Address Successfully")}},Z=()=>{F(!0)},ee=()=>{A(!0)};o.useEffect(()=>{J(!0);const t=localStorage.getItem("btc_addresses");setTimeout(()=>{J(!1)},500),t&&c(JSON.parse(t))},[]);const te=()=>{F(!1)},se=t=>{c(l.filter(s=>s.key!==t)),localStorage.setItem("btc_addresses",JSON.stringify(l.filter(s=>s.key!==t)))},ae=()=>{if(!h.length){b.error({message:"ERROR",description:"Please select which address to delete"},2);return}c(l.filter(t=>!h.includes(t.key))),localStorage.setItem("btc_addresses",JSON.stringify(l.filter(t=>!h.includes(t.key)))),w([])},ne={selectedRowKeys:h,onChange:t=>{w(t)}},le=()=>{A(!1)},[re,M]=o.useState(null),ie=[{title:"BTC MODULE",key:"btc_group",className:"main_btc",children:[{title:"#",key:"index",align:"center",render:(t,s,a)=>a+1},{title:"Name Tags",dataIndex:"name",key:"name",align:"center",render:(t,s)=>s.key===re?e.jsx(B,{placeholder:"Please Enter Name Tag",defaultValue:t,onPressEnter:n=>{s.name=n.target.value,c([...l]),localStorage.setItem("btc_addresses",JSON.stringify(l)),M(null)}}):e.jsxs(e.Fragment,{children:[e.jsx(he,{color:"blue",children:t}),e.jsx(p,{shape:"circle",icon:e.jsx(xe,{}),size:"small",onClick:()=>M(s.key)})]})},{title:"Wallet Address",dataIndex:"address",key:"address",align:"center",render:(t,s)=>t||e.jsx(S,{})},{title:"Final Balance",dataIndex:"final_balance",key:"final_balance",align:"center",render:(t,s)=>t===null?e.jsx(S,{}):t},{title:"No Of Txn",dataIndex:"n_tx",key:"n_tx",align:"center",render:(t,s)=>t===null?e.jsx(S,{}):t},{title:"Total Received",dataIndex:"total_received",key:"total_received",align:"center",render:(t,s)=>t===null?e.jsx(S,{}):t},{title:"Action",key:"action",align:"center",render:(t,s)=>e.jsx(ge,{size:"small",children:e.jsx(V,{title:"Confirm Deletion？",onConfirm:()=>se(s.key),children:e.jsx(p,{icon:e.jsx(Q,{})})})})}]}];return e.jsx("div",{children:e.jsxs(ye,{children:[e.jsx(U,{title:"Batch Import Addresses",open:H,onOk:X,onCancel:le,okButtonProps:{loading:v},okText:"Add Addresses",cancelText:"Cancel",children:e.jsx(g,{form:T,layout:"vertical",children:e.jsx(g.Item,{label:"Name,Addresses",name:"addresses",rules:[{required:!0}],children:e.jsx(pe,{placeholder:"2 formats accepted:- (i)Address only or (ii)Name,Address (separate by comma)",style:{width:"500px",height:"300px"}})})})}),e.jsx(U,{title:"Add Address",open:W,onOk:Y,onCancel:te,okButtonProps:{loading:v},okText:"Add Address",cancelText:"Cancel",children:e.jsxs(g,{form:P,layout:"vertical",children:[e.jsx(g.Item,{label:"Address",name:"address",rules:[{required:!0}],children:e.jsx(B,{placeholder:"Please enter address"})}),e.jsx(g.Item,{label:"Name Tag",name:"name",children:e.jsx(B,{placeholder:"Please enter name tag"})})]})}),e.jsx(S,{spinning:$,children:e.jsx(y,{rowSelection:ne,dataSource:l,pagination:!1,bordered:!0,style:{marginBottom:"20px",zIndex:2},size:"small",columns:ie,summary:t=>{let s=0,a=0,n=0;return t.forEach(({final_balance:d,n_tx:r,total_received:u})=>{s+=Number(d),a+=Number(r),n+=Number(u)}),e.jsx(e.Fragment,{children:e.jsxs(y.Summary.Row,{children:[e.jsx(y.Summary.Cell,{index:0,colSpan:4,children:"TOTAL"}),e.jsx(y.Summary.Cell,{index:4,children:s.toFixed(6)}),e.jsx(y.Summary.Cell,{index:5,children:a}),e.jsx(y.Summary.Cell,{index:6,children:n.toFixed(6)})]})})},footer:()=>e.jsx(de,{children:e.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",gap:"10px"},children:[e.jsx(p,{type:"primary",onClick:Z,size:"large",style:{width:"20%"},icon:e.jsx(oe,{}),children:"Add Address"}),e.jsx(p,{type:"primary",onClick:ee,size:"large",style:{width:"20%"},icon:e.jsx(ce,{}),loading:I,children:I?`Bulk Progress:(${E}/${_})`:"Bulk Import Addresses"}),e.jsx(p,{type:"primary",onClick:G,loading:v,size:"large",style:{width:"20%"},icon:e.jsx(ue,{}),children:v?"Refreshing":"Refresh Selected Address"}),e.jsx(V,{title:"Confirm delete "+h.length+" address？",onConfirm:ae,children:e.jsx(p,{type:"primary",danger:!0,size:"large",style:{width:"20%"},icon:e.jsx(Q,{}),children:"Delete Selected Address"})})]})})})})]})})}export{be as default};
